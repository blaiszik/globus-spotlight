<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="./assets/bootstrap/css/bootstrap.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="./assets/ejs/ejs_production.js"></script>
    <script src="./assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="./assets/bootstrap/js/holder.js"></script>

    <title>Globus Spotlight</title>
    <script type="text/javascript">
        $( document ).ready(function() {
            result_size = 20;

            reset_panels();
            $('.btn-radio-group').button();
            $('#input-search').keyup(function() {
                perform_search();// get the current value of the input field.
            });

            //Button click events
            $('#btn-search').click(function(){
                perform_search();
            });     
            
            $('#btn-start-transfer').click(function(){ 
                console.log('transferring...');
            });       
            
            $('.btn-radio').click(function(){
                $('.btn-radio').removeClass('btn-primary');
                $('.btn-radio').addClass('btn-default');
                $(this).addClass('btn-primary');
            })
            
            $('.quick-tag').click(function(){
                $('#input-search').val('*'+$(this).text()+'*');
                perform_search();
            });
            //End button click events 
        });
        
        function fileSizeSI(a,b,c,d,e){
         return (b=Math,c=b.log,d=1e3,e=c(a)/c(d)|0,a/b.pow(d,e)).toFixed(2)
         +' '+(e?'kMGTPEZY'[--e]+'B':'B')
        //kB,MB,GB,TB,PB,EB,ZB,YB
        }

        function reset_panels(){
            $('#result-block').hide();
            $('#detail-block').hide();
        }
        
        function perform_search(){
            $('#detail-block').show();
            $('#result-block').show();
            requestData = {
                            "size":result_size,
                            "query": {
                                "query_string" : {
                                    "fields" : ["name^2","endpoint"],
                                    "query" : $('#input-search').val()?$('#input-search').val():'*'
                              }
                            }
                        };
            $.ajax({
               type: 'POST',
               url: 'http://localhost:9200/globus_public_index/file/_search',
               data: JSON.stringify(requestData),
               success: function(data) {
                   result_set = data.hits.hits;
                   for(i=0; i<result_set.length; i++){
                        if(result_set[i]._source.size > 0){
                            result_set[i]._source.size = fileSizeSI(result_set[i]._source.size);
                        }else{
                            result_set[i]._source.size = '0 B';
                        }
                    }
                    new EJS({url:'./templates/search_result.ejs'}).update('ejs-search-result',data); 
               }
            });
        }
    </script>
</head>
<body>
    <!-- Top Navigation -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span></button> <a class="navbar-brand" href="#">Globus Spotlight</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- End Top Navigation -->

    <!-- Search Container -->
    <div class="container">
        <div class="well" style="padding-top: 50px; margin-bottom: 5px; font-family:museosans, 'Helvetica Neue', Helvetica, Arial, sans-serif; color:#fff; background-color:#fff; background-image:linear-gradient(#3560A0 0%, #27518F 42%, #27518F 100%);">
        <h2 class="text-default">Find Data</h2>
            <div class="row">
                <div class="col-sm-4" style="padding-top:50px; padding-bottom:10px;">
                    <label class='quick-tag font-white' style="color: #fff">Scattering</label> | <label class='quick-tag font-white' style="color: #fff">Azo</label> |
                    <label class='quick-tag font-white'>SNS</label> |
                    <label class='quick-tag font-white'>Osborn</label> |
                    <label class='quick-tag font-white'>APS</label> |
                    <label class='quick-tag font-white'>more</label>
                </div>

                <div class="col-sm-4">
                    <div class="center-block" style=
                    "padding-top:10px; padding-bottom:10px;"><img style=
                    "display: block; margin-left: auto; margin-right: auto"
                    src="./assets/logo.png"></div>
                </div>
                
                <div class="col-sm-4" style="padding-top:50px; padding-bottom:10px;">
                    <div class="pull-right">
                        <label>Search: Endpoints Shared with Me</label>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <input id='input-search' type="text" class=
                    "form-control input-lg" placeholder=
                    "Start your search here">
                </div><!-- /.col-lg-6 -->
            </div><!-- /.row -->

            <div id="detail-block" class="row" style="padding-left: 0px; padding-bottom: 5px; padding-top: 5px;">
                <div class="col-sm-12">
                    <!-- Split button -->
                    <div class="btn-group btn-radio-group btn-group-justified" data-toggle="buttons">
                        <div class="btn btn-primary btn-radio">
                            <input type="radio" name="options" id="option1">Transfer
                        </div>

                        <div class="btn btn-default btn-radio">
                            <input type="radio" name="options" id="option1">Tag
                        </div>

                        <div class="btn btn-default btn-radio">
                            <input type="radio" name="options" id="option1">Analyze
                        </div>
                    </div>

                    <div id="transfer-detail-block" class="well well-sm" style="padding-top: 5px; padding-bottom: 5px; margin-bottom: 2px; color: #000">
                    <div class="col-sm-2">
                            <div id="action-block">
                                <div id="btn-start-transfer" class="btn btn-primary btn-lg pull-left">
                                    Start
                                </div>
                            </div>
                        </div><b>Destination: <span class="text-primary">Home(go#ep1/home)</span> | SNS(go#ep2/home/SNS)</b>
                        <div>
                            <b><a href="" class="btn btn-primary btn-xs">New Destination</a></b>
                        </div>
                    </div>
                </div>

                <div class="col-xs-1"></div>

                <div class="col-sm-4"></div>
            </div>
        </div>
        <!-- END Search Container -->

        <!-- Result Container -->
        <div id="result-block" class="well" style="padding-top: 5px; background-color:#fff;">
            <div class="row">
                <div class="col-sm-4">
                    <a href="" class="btn btn-default btn-xs">All</a> <a href=
                    "" class="btn btn-default btn-xs">None</a>
                </div>

                <div class="col-sm-6">
                    <b>Current Selection | Files: 52 | 546 MB</b>
                </div>

                <div class="col-sm-2">
                    <div class="pull-right">
                        <a href="" class="btn btn-default btn-xs">Next</a>
                        <a href="" class="btn btn-default btn-xs">Prev</a>
                    </div>
                </div>
            </div>
            <div id="ejs-search-result" class="row"></div>
        </div>
        <!-- END Result Container -->
    </div>
</body>
</html>
